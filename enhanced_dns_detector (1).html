<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNS Tunneling Detection System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #1f1f1f 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
            color: #e0e0e0;
        }

        .sidebar {
            width: 280px;
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(10px);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            padding: 20px;
            box-shadow: 2px 0 20px rgba(0,0,0,0.3);
            overflow-y: auto;
            z-index: 1000;
            transition: transform 0.3s ease;
            border-right: 1px solid #444;
        }

        .sidebar.collapsed {
            transform: translateX(-250px);
        }

        .sidebar-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(45deg, #333, #444);
            color: #e0e0e0;
            border: none;
            padding: 10px 15px;
            border-radius: 25px;
            cursor: pointer;
            z-index: 1001;
            font-size: 18px;
            transition: all 0.3s ease;
            border: 1px solid #555;
        }

        .sidebar-toggle:hover {
            transform: scale(1.1);
            background: linear-gradient(45deg, #444, #555);
        }

        .main-content {
            margin-left: 280px;
            padding: 20px;
            width: calc(100% - 280px);
            transition: all 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 30px;
            width: calc(100% - 60px);
        }

        .sidebar-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #444;
        }

        .sidebar-header h2 {
            color: #e0e0e0;
            font-size: 1.4em;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            color: #888;
        }

        .nav-item {
            display: block;
            padding: 12px 15px;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #333, #444);
            color: #e0e0e0;
            text-decoration: none;
            border-radius: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid #555;
        }

        .nav-item:hover, .nav-item.active {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            background: linear-gradient(45deg, #444, #555);
        }

        .realtime-status {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            border: 1px solid #444;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
            animation: pulse 2s infinite;
        }

        .status-active { background: #28a745; }
        .status-inactive { background: #dc3545; }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: #e0e0e0;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.8;
            color: #bbb;
        }

        .main-card {
            background: rgba(40, 40, 40, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            border: 1px solid #555;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 1.5em;
            color: #e0e0e0;
            margin-bottom: 20px;
            border-bottom: 3px solid #666;
            padding-bottom: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #ccc;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #555;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: #2a2a2a;
            color: #e0e0e0;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #777;
            box-shadow: 0 0 10px rgba(119, 119, 119, 0.3);
        }

        .btn {
            background: linear-gradient(45deg, #333, #444);
            color: #e0e0e0;
            border: 1px solid #555;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #444, #555);
        }

        .btn-toggle {
            background: linear-gradient(45deg, #28a745, #20c997);
            border: 1px solid #20c997;
        }

        .btn-toggle:hover {
            background: linear-gradient(45deg, #20c997, #17a2b8);
        }

        .btn-stop {
            background: linear-gradient(45deg, #dc3545, #c82333);
            border: 1px solid #c82333;
        }

        .btn-stop:hover {
            background: linear-gradient(45deg, #c82333, #a71e2a);
        }

        .result-box {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            display: none;
            border: 1px solid #555;
        }

        .result-legitimate {
            background: linear-gradient(45deg, #1e4a2e, #2d5a3d);
            color: #e0e0e0;
            border-color: #28a745;
        }

        .result-suspicious {
            background: linear-gradient(45deg, #4a3e1e, #5a4d2d);
            color: #e0e0e0;
            border-color: #ffc107;
        }

        .result-tunneling {
            background: linear-gradient(45deg, #4a1e1e, #5a2d2d);
            color: #e0e0e0;
            border-color: #dc3545;
        }

        .realtime-feed {
            background: #2a2a2a;
            border-radius: 10px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
            border: 1px solid #444;
        }

        .feed-item {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid;
            transition: all 0.3s ease;
            background: #333;
        }

        .feed-item.legitimate { 
            border-left-color: #28a745; 
            background: rgba(40, 167, 69, 0.1);
        }
        .feed-item.suspicious { 
            border-left-color: #ffc107; 
            background: rgba(255, 193, 7, 0.1);
        }
        .feed-item.tunneling { 
            border-left-color: #dc3545; 
            background: rgba(220, 53, 69, 0.1);
        }

        .feed-timestamp {
            font-size: 0.8em;
            color: #888;
            margin-bottom: 5px;
        }

        .feed-domain {
            font-weight: bold;
            margin-bottom: 3px;
            color: #e0e0e0;
        }

        .feed-confidence {
            font-size: 0.9em;
            opacity: 0.8;
            color: #ccc;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .feature-item {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #444;
        }

        .feature-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #e0e0e0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(45deg, #333, #444);
            color: #e0e0e0;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid #555;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .loading {
            display: none;
            text-align: center;
            color: #e0e0e0;
            font-weight: 600;
        }

        .spinner {
            border: 3px solid #555;
            border-top: 3px solid #777;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .examples {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 1px solid #444;
        }

        .examples h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
        }

        .example-item {
            margin-bottom: 10px;
            padding: 10px;
            background: #333;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid #555;
            color: #e0e0e0;
        }

        .example-item:hover {
            background: #444;
            border-color: #666;
        }

        .confidence-bar {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
            border: 1px solid #555;
        }

        .confidence-fill {
            height: 100%;
            transition: width 0.5s ease;
        }

        .probability-breakdown {
            margin-top: 15px;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #555;
        }

        .prob-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            color: #e0e0e0;
        }

        .prob-bar {
            width: 60%;
            height: 8px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
            border: 1px solid #555;
        }

        .prob-fill {
            height: 100%;
            background: #777;
            transition: width 0.3s ease;
        }

        .realtime-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .interval-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .interval-control select {
            width: auto;
            min-width: 120px;
        }

        .interval-control label {
            color: #ccc;
            margin-bottom: 0;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-250px);
            }
            
            .main-content {
                margin-left: 0;
                width: 100%;
            }
            
            .sidebar-toggle {
                display: block;
            }
        }

        /* Scrollbar styling for dark theme */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #2a2a2a;
        }

        ::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
    </style>
</head>
<body>
    <button class="sidebar-toggle" onclick="toggleSidebar()">☰</button>
    
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2> DNS Monitor</h2>
            <p>Security Dashboard</p>
        </div>
        
        <a class="nav-item active" onclick="showSection('manual-analysis')">
             Manual testing
        </a>
        <a class="nav-item" onclick="showSection('realtime-monitoring')">
             Real-time Monitoring
        </a>
        <a class="nav-item" onclick="showSection('statistics')">
             Statistics
        </a>
        <a class="nav-item" onclick="showSection('settings')">
             Settings
        </a>
        
        <div class="realtime-status">
            <div class="status-indicator">
                <div class="status-dot status-inactive" id="statusDot"></div>
                <span id="statusText">Monitoring: Inactive</span>
            </div>
            <div style="font-size: 0.9em; color: #666;">
                Processed: <span id="processedCount">0</span> queries
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="container">
            <div class="header">
                <h1> DNS Tunneling Detection System</h1>
                <p>ML-Based Real-time DNS Traffic Analysis</p>
            </div>

            <!-- Manual Analysis Section -->
            <div class="section active" id="manual-analysis">
                <div class="main-card">
                    <h2 class="section-title">Manual DNS Analysis</h2>
                    
                    <div class="input-group">
                        <label for="dnsQuery">DNS Query/Domain Name:</label>
                        <input type="text" id="dnsQuery" placeholder="e.g., enter the domain or query">
                    </div>

                    <div class="input-group">
                        <label for="queryType">Query Type:</label>
                        <select id="queryType">
                            <option value="A">A Record</option>
                            <option value="AAAA">AAAA Record</option>
                            <option value="TXT">TXT Record</option>
                            <option value="MX">MX Record</option>
                            <option value="CNAME">CNAME Record</option>
                            <option value="NS">NS Record</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label for="querySize">Query Size (bytes):</label>
                        <input type="text" id="querySize" placeholder="e.g., 45">
                    </div>

                    <button class="btn" onclick="analyzeDNS()">🔍 Analyze DNS Request</button>
                    <button class="btn" onclick="clearResults()">🔄 Clear Results</button>

                    <div class="loading" id="loading">
                        <div class="spinner"></div>
                        <p>Analyzing DNS request...</p>
                    </div>

                    <div class="result-box" id="resultBox">
                        <h3 id="resultTitle"></h3>
                        <p id="resultDescription"></p>
                        <div class="confidence-bar">
                            <div class="confidence-fill" id="confidenceFill"></div>
                        </div>
                        <p id="confidenceText"></p>
                        
                        <div class="probability-breakdown" id="probBreakdown">
                            <h4 style="margin-bottom: 10px;">Classification Probabilities:</h4>
                            <div class="prob-item">
                                <span>Legitimate:</span>
                                <div class="prob-bar"><div class="prob-fill" id="legitProb"></div></div>
                                <span id="legitPercent">0%</span>
                            </div>
                            <div class="prob-item">
                                <span>Suspicious:</span>
                                <div class="prob-bar"><div class="prob-fill" id="suspProb"></div></div>
                                <span id="suspPercent">0%</span>
                            </div>
                            <div class="prob-item">
                                <span>Tunneling:</span>
                                <div class="prob-bar"><div class="prob-fill" id="tunnelProb"></div></div>
                                <span id="tunnelPercent">0%</span>
                            </div>
                        </div>
                    </div>

                    <div class="features-grid" id="featuresGrid" style="display: none;">
                        <div class="feature-item">
                            <div class="feature-value" id="domainLength">-</div>
                            <div>Domain Length</div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-value" id="subdomainCount">-</div>
                            <div>Subdomain Count</div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-value" id="entropy">-</div>
                            <div>Entropy Score</div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-value" id="suspiciousChars">-</div>
                            <div>Suspicious Chars</div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-value" id="base64Ratio">-</div>
                            <div>Base64 Ratio</div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-value" id="hexRatio">-</div>
                            <div>Hex Ratio</div>
                        </div>
                    </div>

                    
                </div>
            </div>

            <!-- Real-time Monitoring Section -->
           <div class="section" id="realtime-monitoring">
    <div class="main-card">
        <h2 class="section-title">DNS Query Analysis from CSV</h2>
        
        <div class="input-group">
            <label for="csvFile">Upload CSV File:</label>
            <input type="file" id="csvFile" accept=".csv" onchange="handleCSVUpload(event)">
            <p style="font-size: 0.9em; color: #888; margin-top: 5px;">
                CSV should have columns: domain, query_type, query_size (optional)
            </p>
        </div>
        
        <div class="realtime-controls">
            <button class="btn btn-toggle" id="toggleBtn" onclick="startCSVAnalysis()" disabled>
                 Start Analysis
            </button>
            <button class="btn btn-stop" onclick="stopCSVAnalysis()">
                 Stop
            </button>
            
            <div class="interval-control">
                <label for="analysisSpeed">Speed:</label>
                <select id="analysisSpeed">
                    <option value="500">Fast (0.5s)</option>
                    <option value="1000" selected>Normal (1s)</option>
                    <option value="2000">Slow (2s)</option>
                </select>
            </div>
        </div>

        <div id="csvStatus" style="display: none; margin: 15px 0; padding: 10px; background: #2a2a2a; border-radius: 8px;">
            <div> File: <span id="fileName"></span></div>
            <div> Total Queries: <span id="totalQueries">0</span></div>
            <div> Processed: <span id="processedQueries">0</span></div>
            <div> Progress: <span id="progressPercent">0%</span></div>
            <div class="confidence-bar" style="margin-top: 10px;">
                <div class="confidence-fill" id="progressBar" style="background: #28a745;"></div>
            </div>
        </div>

        <div class="realtime-feed" id="realtimeFeed">
            <div style="text-align: center; color: #666; padding: 40px;">
                <p> Upload a CSV file to begin analysis</p>
                <p>CSV format: domain, query_type, query_size (optional)</p>
            </div>
        </div>
    </div>
</div>

            <!-- Statistics Section -->
            <div class="section" id="statistics">
                <div class="main-card">
                    <h2 class="section-title">Detection Statistics</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="totalAnalyzed">0</div>
                            <div>Total Analyzed</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="legitimateCount">0</div>
                            <div>Legitimate</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="suspiciousCount">0</div>
                            <div>Suspicious</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="tunnelingCount">0</div>
                            <div>Tunneling</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div class="section" id="settings">
                <div class="main-card">
                    <h2 class="section-title">Detection Settings</h2>
                    
                    <div class="input-group">
                        <label for="sensitivityLevel">Detection Sensitivity:</label>
                        <select id="sensitivityLevel">
                            <option value="low">Low - Fewer false positives</option>
                            <option value="medium" selected>Medium - Balanced detection</option>
                            <option value="high">High - More sensitive detection</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label for="maxFeedItems">Max Feed Items:</label>
                        <input type="number" id="maxFeedItems" value="50" min="10" max="200">
                    </div>
                    
                    <button class="btn" onclick="saveSettings()">💾 Save Settings</button>
                    <button class="btn" onclick="resetSettings()">🔄 Reset to Default</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced DNS Tunneling Detection System
        class DNSTunnelingDetector {
            constructor() {
                this.stats = {
                    total: 0,
                    legitimate: 0,
                    suspicious: 0,
                    tunneling: 0
                };
                this.settings = {
                    sensitivity: 'medium',
                    maxFeedItems: 50
                };
                this.realtimeInterval = null;
                this.isMonitoring = false;
            }

           
            getSampleDomains() {
                const legitimate = [
                    'google.com', 'facebook.com', 'amazon.com', 'microsoft.com', 'apple.com',
                    'github.com', 'stackoverflow.com', 'wikipedia.org', 'youtube.com', 'twitter.com'
                ];
                
                const suspicious = [
                    'long-domain-name-with-many-parts.suspicious.net',
                    'random123456789.data.example.org',
                    'multiple.sub.domains.here.test.com',
                    'base64like.aGVsbG8.domain.co.uk'
                ];
                
                const tunneling = [
                    'aGVsbG93b3JsZGRhdG.tunnel.evil.com',
                    '48656c6c6f576f726c643132.hex.malicious.net',
                    'qwertyuiopasdfghjklzxcvbnm1234567890abcdef.exfiltrate.badguy.org',
                    'YWxhZGRpbjpvcGVuc2VzYW1l.b64data.attacker.io',
                    '4d616c6963696f757344617461.hexenc.cyber.criminal'
                ];
                
                return { legitimate, suspicious, tunneling };
            }

            generateRandomDomain() {
                const domains = this.getSampleDomains();
                const categories = ['legitimate', 'suspicious', 'tunneling'];
                const weights = this.settings.sensitivity === 'low' ? [0.7, 0.2, 0.1] :
                               this.settings.sensitivity === 'medium' ? [0.5, 0.3, 0.2] :
                               [0.3, 0.4, 0.3];
                
                const rand = Math.random();
                let category;
                if (rand < weights[0]) category = 'legitimate';
                else if (rand < weights[0] + weights[1]) category = 'suspicious';
                else category = 'tunneling';
                
                const categoryDomains = domains[category];
                const domain = categoryDomains[Math.floor(Math.random() * categoryDomains.length)];
                const querySize = Math.floor(Math.random() * 200) + 30;
                const queryTypes = ['A', 'AAAA', 'TXT', 'MX', 'CNAME'];
                const queryType = queryTypes[Math.floor(Math.random() * queryTypes.length)];
                
                return { domain, querySize, queryType };
            }

            extractFeatures(domain, queryType, querySize) {
                const features = {
                    domainLength: domain.length,
                    subdomainCount: (domain.match(/\./g) || []).length,
                    entropy: this.calculateEntropy(domain),
                    suspiciousChars: this.countSuspiciousChars(domain),
                    querySize: parseInt(querySize) || domain.length + 20,
                    base64Ratio: this.calculateBase64Ratio(domain),
                    hexRatio: this.calculateHexRatio(domain),
                    numericRatio: this.calculateNumericRatio(domain),
                    consecutiveChars: this.countConsecutiveChars(domain),
                    isKnownTLD: this.isKnownTLD(domain)
                };

                return features;
            }

            calculateEntropy(str) {
                const freq = {};
                for (let char of str.toLowerCase()) {
                    freq[char] = (freq[char] || 0) + 1;
                }

                let entropy = 0;
                const len = str.length;
                for (let char in freq) {
                    const p = freq[char] / len;
                    entropy -= p * Math.log2(p);
                }

                return entropy;
            }

            countSuspiciousChars(domain) {
                const suspicious = /[0-9\-_]/g;
                return (domain.match(suspicious) || []).length;
            }

            calculateBase64Ratio(domain) {
                const parts = domain.split('.');
                let maxBase64Ratio = 0;
                
                for (let part of parts) {
                    if (part.length > 10) {
                        const base64Chars = /[A-Za-z0-9+/=]/g;
                        const matches = part.match(base64Chars) || [];
                        const ratio = matches.length / part.length;
                        if (ratio > maxBase64Ratio) {
                            maxBase64Ratio = ratio;
                        }
                    }
                }
                
                return maxBase64Ratio;
            }

            calculateHexRatio(domain) {
                const parts = domain.split('.');
                let maxHexRatio = 0;
                
                for (let part of parts) {
                    if (part.length > 8) {
                        const hexChars = /[0-9A-Fa-f]/g;
                        const matches = part.match(hexChars) || [];
                        const ratio = matches.length / part.length;
                        if (ratio > maxHexRatio && ratio > 0.6) {
                            maxHexRatio = ratio;
                        }
                    }
                }
                
                return maxHexRatio;
            }

            calculateNumericRatio(domain) {
                const numChars = /[0-9]/g;
                const matches = domain.match(numChars) || [];
                return matches.length / domain.length;
            }

            countConsecutiveChars(domain) {
                let maxConsecutive = 0;
                let currentConsecutive = 1;
                
                for (let i = 1; i < domain.length; i++) {
                    if (domain[i] === domain[i-1]) {
                        currentConsecutive++;
                    } else {
                        maxConsecutive = Math.max(maxConsecutive, currentConsecutive);
                        currentConsecutive = 1;
                    }
                }
                
                return Math.max(maxConsecutive, currentConsecutive);
            }

            isKnownTLD(domain) {
                const knownTLDs = ['.com', '.org', '.net', '.edu', '.gov', '.mil', '.int', 
                                 '.co.uk', '.de', '.fr', '.jp', '.cn', '.au', '.ca', '.br'];
                return knownTLDs.some(tld => domain.toLowerCase().endsWith(tld));
            }

            predict(domain, queryType, querySize) {
                const features = this.extractFeatures(domain, queryType, querySize);
                
                // Adjust scoring based on sensitivity
                const sensitivityMultiplier = this.settings.sensitivity === 'low' ? 0.8 :
                                            this.settings.sensitivity === 'medium' ? 1.0 : 1.2;
                
                let legitScore = 0;
                let suspScore = 0;
                let tunnelScore = 0;

                // Domain length scoring
                if (features.domainLength < 30) {
                    legitScore += 30;
                } else if (features.domainLength < 50) {
                    suspScore += 20 * sensitivityMultiplier;
                } else {
                    tunnelScore += 40 * sensitivityMultiplier;
                }

                // Subdomain count scoring
                if (features.subdomainCount <= 2) {
                    legitScore += 20;
                } else if (features.subdomainCount <= 4) {
                    suspScore += 15 * sensitivityMultiplier;
                } else {
                    tunnelScore += 30 * sensitivityMultiplier;
                }

                // Entropy scoring
                if (features.entropy < 3.0) {
                    legitScore += 25;
                } else if (features.entropy < 4.0) {
                    suspScore += 20 * sensitivityMultiplier;
                } else {
                    tunnelScore += 35 * sensitivityMultiplier;
                }

                // Base64 ratio scoring
                if (features.base64Ratio > 0.8) {
                    tunnelScore += 50 * sensitivityMultiplier;
                } else if (features.base64Ratio > 0.6) {
                    suspScore += 30 * sensitivityMultiplier;
                } else if (features.base64Ratio > 0.4) {
                    suspScore += 15 * sensitivityMultiplier;
                } else {
                    legitScore += 10;
                }

                // Hex ratio scoring
                if (features.hexRatio > 0.7) {
                    tunnelScore += 45 * sensitivityMultiplier;
                } else if (features.hexRatio > 0.4) {
                    suspScore += 25 * sensitivityMultiplier;
                } else {
                    legitScore += 5;
                }

                // Suspicious characters scoring
                if (features.suspiciousChars > features.domainLength * 0.3) {
                    tunnelScore += 25 * sensitivityMultiplier;
                } else if (features.suspiciousChars > features.domainLength * 0.15) {
                    suspScore += 15 * sensitivityMultiplier;
                } else {
                    legitScore += 10;
                }

                // Known TLD bonus
                if (features.isKnownTLD) {
                    legitScore += 15;
                } else {
                    suspScore += 10 * sensitivityMultiplier;
                }

                // Query size scoring
                if (features.querySize > 200) {
                    tunnelScore += 20 * sensitivityMultiplier;
                } else if (features.querySize > 100) {
                    suspScore += 10 * sensitivityMultiplier;
                } else {
                    legitScore += 5;
                }

                // TXT records are more suspicious
                if (queryType === 'TXT') {
                    suspScore += 15 * sensitivityMultiplier;
                    tunnelScore += 15 * sensitivityMultiplier;
                }

                // Normalize scores to probabilities
                const totalScore = legitScore + suspScore + tunnelScore;
                const probabilities = {
                    legitimate: legitScore / totalScore,
                    suspicious: suspScore / totalScore,
                    tunneling: tunnelScore / totalScore
                };

                // Determine classification
                const maxProb = Math.max(probabilities.legitimate, probabilities.suspicious, probabilities.tunneling);
                let classification, risk;

                if (probabilities.legitimate === maxProb) {
                    classification = 'Legitimate';
                    risk = 'low';
                    this.stats.legitimate++;
                } else if (probabilities.suspicious === maxProb) {
                    classification = 'Suspicious';
                    risk = 'medium';
                    this.stats.suspicious++;
                } else {
                    classification = 'Tunneling Detected';
                    risk = 'high';
                    this.stats.tunneling++;
                }

                this.stats.total++;

                return {
                    classification,
                    risk,
                    confidence: maxProb,
                    features,
                    probabilities,
                    scores: { legitScore, suspScore, tunnelScore }
                };
            }
            
            startRealTimeMonitoring(interval = 2000) {
                if (this.isMonitoring) return;
                
                this.isMonitoring = true;
                this.realtimeInterval = setInterval(() => {
                    const { domain, querySize, queryType } = this.generateRandomDomain();
                    const result = this.predict(domain, queryType, querySize);
                    this.addToRealtimeFeed(domain, queryType, result);
                    updateStats();
                    updateSidebarStatus();
                }, interval);
            }

            stopRealTimeMonitoring() {
                if (!this.isMonitoring) return;
                
                this.isMonitoring = false;
                if (this.realtimeInterval) {
                    clearInterval(this.realtimeInterval);
                    this.realtimeInterval = null;
                }
            }

            addToRealtimeFeed(domain, queryType, result) {
                const feed = document.getElementById('realtimeFeed');
                const timestamp = new Date().toLocaleTimeString();
                
                const feedItem = document.createElement('div');
                feedItem.className = `feed-item ${result.risk === 'low' ? 'legitimate' : result.risk === 'medium' ? 'suspicious' : 'tunneling'}`;
                
                feedItem.innerHTML = `
                    <div class="feed-timestamp">${timestamp}</div>
                    <div class="feed-domain">${domain} (${queryType})</div>
                    <div class="feed-confidence">
                        ${result.classification} - Confidence: ${(result.confidence * 100).toFixed(1)}%
                    </div>
                `;
                
                // Add animation
                feedItem.style.opacity = '0';
                feedItem.style.transform = 'translateY(-10px)';
                
                if (feed.children.length === 0 || feed.children[0].style.textAlign) {
                    feed.innerHTML = '';
                }
                
                feed.insertBefore(feedItem, feed.firstChild);
                
                // Animate in
                setTimeout(() => {
                    feedItem.style.transition = 'all 0.3s ease';
                    feedItem.style.opacity = '1';
                    feedItem.style.transform = 'translateY(0)';
                }, 10);
                
                // Remove excess items
                const maxItems = this.settings.maxFeedItems;
                while (feed.children.length > maxItems) {
                    feed.removeChild(feed.lastChild);
                }
            }
        }

        // Initialize the detector
        const detector = new DNSTunnelingDetector();
        let sidebarCollapsed = false;
        let csvData = [];
let currentIndex = 0;
let csvAnalysisInterval = null;
let isCsvAnalysisRunning = false;

async function handleCSVUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    try {
        const text = await file.text();
        
        // Simple CSV parsing (you can use Papa Parse library for more robust parsing)
        const lines = text.split('\n').filter(line => line.trim());
        const headers = lines[0].toLowerCase().split(',').map(h => h.trim());
        
        // Find column indices
        const domainIndex = headers.findIndex(h => h.includes('domain') || h.includes('query'));
        const typeIndex = headers.findIndex(h => h.includes('type') || h.includes('record'));
        const sizeIndex = headers.findIndex(h => h.includes('size') || h.includes('length'));
        
        if (domainIndex === -1) {
            alert('CSV must have a domain/query column');
            return;
        }
        
        csvData = [];
        for (let i = 1; i < lines.length; i++) {
            const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
            if (values[domainIndex]) {
                csvData.push({
                    domain: values[domainIndex],
                    queryType: typeIndex !== -1 ? values[typeIndex] || 'A' : 'A',
                    querySize: sizeIndex !== -1 ? values[sizeIndex] || '' : ''
                });
            }
        }
        
        if (csvData.length === 0) {
            alert('No valid data found in CSV');
            return;
        }
        
        // Update UI
        document.getElementById('fileName').textContent = file.name;
        document.getElementById('totalQueries').textContent = csvData.length;
        document.getElementById('processedQueries').textContent = '0';
        document.getElementById('progressPercent').textContent = '0%';
        document.getElementById('progressBar').style.width = '0%';
        document.getElementById('csvStatus').style.display = 'block';
        document.getElementById('toggleBtn').disabled = false;
        
        // Clear previous results
        const feed = document.getElementById('realtimeFeed');
        feed.innerHTML = '<div style="text-align: center; color: #28a745; padding: 20px;"><p>✅ CSV loaded successfully! Click "Start Analysis" to begin.</p></div>';
        
        currentIndex = 0;
        
    } catch (error) {
        alert('Error reading CSV file: ' + error.message);
    }
}

function startCSVAnalysis() {
    if (csvData.length === 0) {
        alert('Please upload a CSV file first');
        return;
    }
    
    if (isCsvAnalysisRunning) return;
    
    isCsvAnalysisRunning = true;
    const speed = parseInt(document.getElementById('analysisSpeed').value);
    const toggleBtn = document.getElementById('toggleBtn');
    
    toggleBtn.textContent = '⏸ Pause Analysis';
    toggleBtn.onclick = pauseCSVAnalysis;
    
    // Clear feed if starting fresh
    if (currentIndex === 0) {
        document.getElementById('realtimeFeed').innerHTML = '';
    }
    
    csvAnalysisInterval = setInterval(() => {
        if (currentIndex >= csvData.length) {
            stopCSVAnalysis();
            return;
        }
        
        const query = csvData[currentIndex];
        const result = detector.predict(query.domain, query.queryType, query.querySize);
        
        // Add to feed
        detector.addToRealtimeFeed(query.domain, query.queryType, result);
        
        currentIndex++;
        
        // Update progress
        const progress = (currentIndex / csvData.length) * 100;
        document.getElementById('processedQueries').textContent = currentIndex;
        document.getElementById('progressPercent').textContent = progress.toFixed(1) + '%';
        document.getElementById('progressBar').style.width = progress + '%';
        
        updateStats();
        updateSidebarStatus();
        
    }, speed);
    
    // Update detector monitoring status
    detector.isMonitoring = true;
    updateSidebarStatus();
}

function pauseCSVAnalysis() {
    if (!isCsvAnalysisRunning) return;
    
    isCsvAnalysisRunning = false;
    detector.isMonitoring = false;
    
    if (csvAnalysisInterval) {
        clearInterval(csvAnalysisInterval);
        csvAnalysisInterval = null;
    }
    
    const toggleBtn = document.getElementById('toggleBtn');
    toggleBtn.textContent = '▶ Resume Analysis';
    toggleBtn.onclick = startCSVAnalysis;
    
    updateSidebarStatus();
}

function stopCSVAnalysis() {
    isCsvAnalysisRunning = false;
    detector.isMonitoring = false;
    
    if (csvAnalysisInterval) {
        clearInterval(csvAnalysisInterval);
        csvAnalysisInterval = null;
    }
    
    const toggleBtn = document.getElementById('toggleBtn');
    toggleBtn.textContent = ' Start Analysis';
    toggleBtn.onclick = startCSVAnalysis;
    
    updateSidebarStatus();
    
    if (currentIndex >= csvData.length) {
        // Analysis complete
        const feed = document.getElementById('realtimeFeed');
        const completeDiv = document.createElement('div');
        completeDiv.style.cssText = 'text-align: center; color: #28a745; padding: 20px; background: rgba(40, 167, 69, 0.1); border-radius: 10px; margin: 10px 0;';
        completeDiv.innerHTML = '<h3> Analysis Complete!</h3><p>All queries have been processed.</p>';
        feed.insertBefore(completeDiv, feed.firstChild);
    }
}

        // Navigation functions
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to clicked nav item
            event.target.classList.add('active');
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            
            sidebarCollapsed = !sidebarCollapsed;
            
            if (sidebarCollapsed) {
                sidebar.classList.add('collapsed');
                mainContent.classList.add('expanded');
            } else {
                sidebar.classList.remove('collapsed');
                mainContent.classList.remove('expanded');
            }
        }

        // Real-time monitoring functions
        function toggleRealTimeMonitoring() {
            const btn = document.getElementById('toggleBtn');
            const interval = parseInt(document.getElementById('monitorInterval').value);
            
            if (!detector.isMonitoring) {
                detector.startRealTimeMonitoring(interval);
                btn.textContent = '⏸ Pause Monitoring';
                btn.classList.add('btn-stop');
                updateSidebarStatus();
            } else {
                detector.stopRealTimeMonitoring();
                btn.textContent = ' Start Monitoring';
                btn.classList.remove('btn-stop');
                updateSidebarStatus();
            }
        }

        function stopRealTimeMonitoring() {
            detector.stopRealTimeMonitoring();
            document.getElementById('toggleBtn').textContent = ' Start Monitoring';
            document.getElementById('toggleBtn').classList.remove('btn-stop');
            updateSidebarStatus();
        }

        function updateSidebarStatus() {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            const processedCount = document.getElementById('processedCount');
            
            if (detector.isMonitoring) {
                statusDot.className = 'status-dot status-active';
                statusText.textContent = 'Monitoring: Active';
            } else {
                statusDot.className = 'status-dot status-inactive';
                statusText.textContent = 'Monitoring: Inactive';
            }
            
            processedCount.textContent = detector.stats.total;
        }

        // Settings functions
        function saveSettings() {
            detector.settings.sensitivity = document.getElementById('sensitivityLevel').value;
            detector.settings.maxFeedItems = parseInt(document.getElementById('maxFeedItems').value);
            alert('Settings saved successfully!');
        }

        function resetSettings() {
            document.getElementById('sensitivityLevel').value = 'medium';
            document.getElementById('maxFeedItems').value = '50';
            detector.settings.sensitivity = 'medium';
            detector.settings.maxFeedItems = 50;
            alert('Settings reset to default!');
        }

        // Manual analysis functions
        async function analyzeDNS() {
            const domain = document.getElementById('dnsQuery').value.trim();
            const queryType = document.getElementById('queryType').value;
            const querySize = document.getElementById('querySize').value;

            if (!domain) {
                alert('Please enter a DNS query or domain name');
                return;
            }

            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultBox').style.display = 'none';
            document.getElementById('featuresGrid').style.display = 'none';

            try {
                // Simulate processing time
                await new Promise(resolve => setTimeout(resolve, 1200));

                const result = detector.predict(domain, queryType, querySize);

                // Hide loading
                document.getElementById('loading').style.display = 'none';

                // Show results
                displayResults(result);
                updateStats();

            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                alert('Error analyzing DNS request: ' + error.message);
            }
        }

        function displayResults(result) {
            const resultBox = document.getElementById('resultBox');
            const resultTitle = document.getElementById('resultTitle');
            const resultDescription = document.getElementById('resultDescription');
            const confidenceFill = document.getElementById('confidenceFill');
            const confidenceText = document.getElementById('confidenceText');

            // Set result class based on risk
            resultBox.className = 'result-box result-' + 
                (result.risk === 'low' ? 'legitimate' : 
                 result.risk === 'medium' ? 'suspicious' : 'tunneling');

            resultTitle.textContent = result.classification;
            
            let description = '';
            if (result.risk === 'low') {
                description = 'This DNS request appears to be legitimate with normal characteristics.';
            } else if (result.risk === 'medium') {
                description = 'This DNS request shows suspicious patterns that may indicate potential tunneling activity. Monitor for repeated queries.';
            } else {
                description = 'This DNS request shows strong indicators of DNS tunneling activity. Immediate investigation recommended!';
            }
            
            resultDescription.textContent = description;

            // Set confidence bar
            const confidencePercent = (result.confidence * 100).toFixed(1);
            confidenceFill.style.width = confidencePercent + '%';
            confidenceFill.style.backgroundColor = 
                result.risk === 'low' ? '#28a745' : 
                result.risk === 'medium' ? '#ffc107' : '#dc3545';
            
            confidenceText.textContent = `Confidence: ${confidencePercent}%`;

            // Update probability breakdown
            const legitPercent = (result.probabilities.legitimate * 100).toFixed(1);
            const suspPercent = (result.probabilities.suspicious * 100).toFixed(1);
            const tunnelPercent = (result.probabilities.tunneling * 100).toFixed(1);

            document.getElementById('legitProb').style.width = legitPercent + '%';
            document.getElementById('suspProb').style.width = suspPercent + '%';
            document.getElementById('tunnelProb').style.width = tunnelPercent + '%';

            document.getElementById('legitPercent').textContent = legitPercent + '%';
            document.getElementById('suspPercent').textContent = suspPercent + '%';
            document.getElementById('tunnelPercent').textContent = tunnelPercent + '%';

            // Show features
            document.getElementById('domainLength').textContent = result.features.domainLength;
            document.getElementById('subdomainCount').textContent = result.features.subdomainCount;
            document.getElementById('entropy').textContent = result.features.entropy.toFixed(2);
            document.getElementById('suspiciousChars').textContent = result.features.suspiciousChars;
            document.getElementById('base64Ratio').textContent = (result.features.base64Ratio * 100).toFixed(1) + '%';
            document.getElementById('hexRatio').textContent = (result.features.hexRatio * 100).toFixed(1) + '%';

            resultBox.style.display = 'block';
            document.getElementById('featuresGrid').style.display = 'grid';
        }

        function updateStats() {
            document.getElementById('totalAnalyzed').textContent = detector.stats.total;
            document.getElementById('legitimateCount').textContent = detector.stats.legitimate;
            document.getElementById('suspiciousCount').textContent = detector.stats.suspicious;
            document.getElementById('tunnelingCount').textContent = detector.stats.tunneling;
        }

        function clearResults() {
            document.getElementById('dnsQuery').value = '';
            document.getElementById('querySize').value = '';
            document.getElementById('resultBox').style.display = 'none';
            document.getElementById('featuresGrid').style.display = 'none';
        }

        function setExample(domain, size) {
            document.getElementById('dnsQuery').value = domain;
            document.getElementById('querySize').value = size || (domain.length + Math.floor(Math.random() * 20) + 10);
        }

        // Initialize
        updateStats();
        updateSidebarStatus();

        // Auto-collapse sidebar on mobile
        if (window.innerWidth <= 768) {
            toggleSidebar();
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth <= 768 && !sidebarCollapsed) {
                toggleSidebar();
            } else if (window.innerWidth > 768 && sidebarCollapsed) {
                toggleSidebar();
            }
        });
    </script>
</body>
</html>